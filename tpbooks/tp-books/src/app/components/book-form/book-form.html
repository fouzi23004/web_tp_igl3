<div class="form-container">
  <h2>{{ isEditMode ? 'Modifier le livre' : 'Ajouter un livre' }}</h2>

  <form #bookForm="ngForm" (ngSubmit)="onSubmit(bookForm)">
    <!-- Title -->
    <div class="form-group">
      <label for="title">Titre *</label>
      <input
        type="text"
        id="title"
        name="title"
        [(ngModel)]="book.title"
        required
        minlength="3"
        #title="ngModel">
      @if (title.invalid && title.dirty) {
        <div class="error-message">
          @if (title.errors?.['required']) {
            <span>Le titre est requis.</span>
          }
          @if (title.errors?.['minlength']) {
            <span>Le titre doit contenir au moins 3 caractères.</span>
          }
        </div>
      }
      @if (isTitleOnlyDigits() && title.dirty) {
        <div class="error-message">
          <span>Le titre ne peut pas être composé uniquement de chiffres.</span>
        </div>
      }
    </div>

    <!-- Author -->
    <div class="form-group">
      <label for="author">Auteur *</label>
      <input
        type="text"
        id="author"
        name="author"
        [(ngModel)]="book.author"
        required
        minlength="3"
        #author="ngModel">
      @if (author.invalid && author.dirty) {
        <div class="error-message">
          @if (author.errors?.['required']) {
            <span>L'auteur est requis.</span>
          }
          @if (author.errors?.['minlength']) {
            <span>L'auteur doit contenir au moins 3 caractères.</span>
          }
        </div>
      }
    </div>

    <!-- Publisher Email -->
    <div class="form-group">
      <label for="publisherEmail">Email éditeur *</label>
      <input
        type="email"
        id="publisherEmail"
        name="publisherEmail"
        [(ngModel)]="book.publisherEmail"
        required
        email
        #publisherEmail="ngModel">
      @if (publisherEmail.invalid && publisherEmail.dirty) {
        <div class="error-message">
          @if (publisherEmail.errors?.['required']) {
            <span>L'email est requis.</span>
          }
          @if (publisherEmail.errors?.['email']) {
            <span>L'email n'est pas valide.</span>
          }
        </div>
      }
    </div>

    <!-- Publisher Phone -->
    <div class="form-group">
      <label for="publisherPhone">Téléphone éditeur</label>
      <input
        type="text"
        id="publisherPhone"
        name="publisherPhone"
        [(ngModel)]="book.publisherPhone"
        pattern="^[0-9]{8}$"
        #publisherPhone="ngModel">
      @if (publisherPhone.invalid && publisherPhone.dirty) {
        <div class="error-message">
          @if (publisherPhone.errors?.['pattern']) {
            <span>Le téléphone doit contenir 8 chiffres (format tunisien).</span>
          }
        </div>
      }
    </div>

    <!-- Release Date -->
    <div class="form-group">
      <label for="releaseDate">Date de parution *</label>
      <input
        type="date"
        id="releaseDate"
        name="releaseDate"
        [(ngModel)]="book.releaseDate"
        required
        min="1901-01-01"
        #releaseDate="ngModel">
      @if (releaseDate.invalid && releaseDate.dirty) {
        <div class="error-message">
          @if (releaseDate.errors?.['required']) {
            <span>La date de parution est requise.</span>
          }
          @if (releaseDate.errors?.['min']) {
            <span>La date doit être postérieure à 1900.</span>
          }
        </div>
      }
    </div>

    <!-- Category -->
    <div class="form-group">
      <label for="category">Catégorie *</label>
      <select
        id="category"
        name="category"
        [(ngModel)]="book.category"
        required
        #category="ngModel">
        <option value="">-- Sélectionner --</option>
        @for (cat of categories; track cat) {
          <option [value]="cat">{{ cat }}</option>
        }
      </select>
      @if (category.invalid && category.dirty) {
        <div class="error-message">
          <span>La catégorie est requise.</span>
        </div>
      }
    </div>

    <!-- Is Available -->
    <div class="form-group checkbox-group">
      <label>
        <input
          type="checkbox"
          id="isAvailable"
          name="isAvailable"
          [(ngModel)]="book.isAvailable">
        Disponible
      </label>
    </div>

    <!-- Stock -->
    <div class="form-group">
      <label for="stock">Stock</label>
      <input
        type="number"
        id="stock"
        name="stock"
        [(ngModel)]="book.stock"
        min="0"
        #stock="ngModel">
      @if (stock.invalid && stock.dirty) {
        <div class="error-message">
          @if (stock.errors?.['min']) {
            <span>Le stock doit être supérieur ou égal à 0.</span>
          }
        </div>
      }
    </div>

    <!-- Buttons -->
    <div class="button-group">
      <button type="submit" [disabled]="bookForm.invalid || isTitleOnlyDigits()">
        {{ isEditMode ? 'Mettre à jour' : 'Ajouter' }}
      </button>
      @if (isEditMode) {
        <button type="button" class="cancel-btn" (click)="cancelEdit()">
          Annuler
        </button>
      }
    </div>
  </form>
</div>
